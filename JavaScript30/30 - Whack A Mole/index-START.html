<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Whack A Mole!</title>
  <link href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <h1>Whack-a-mole! <span class="score">0</span></h1>
  <h2>Choose your name</h2>
  <div class="inputfield">
    <input type="text" spellcheck="false" class="inputtext" placeholder="Type your name here"></input>
  </div>
  <h2>Choose your difficulty!</h2>
  <div class="buttons">
    <button class="button" onClick="startGame(10, 400, 1800), this.disable=true">Easy mode!</button>
    <button class="button" onClick="startGame(12, 380, 1340)">Normal mode!</button>
    <button class="button" onClick="startGame(14, 300, 1080)">Hard mode!</button>
    <button class="button" onClick="startGame(15, 280, 840)">Insane mode!</button>
    <button class="button" onClick="startGame(16, 220, 480)">GOD mode!</button>
  </div>

  <div>
    <h2 class="timer">Game will begin after you choose your name and difficulty</h2>
  </div>

  <div class="game">
    <div class="hole hole1">
      <div class="mole"></div>
    </div>
    <div class="hole hole2">
      <div class="mole"></div>
    </div>
    <div class="hole hole3">
      <div class="mole"></div>
    </div>
    <div class="hole hole4">
      <div class="mole"></div>
    </div>
    <div class="hole hole5">
      <div class="mole"></div>
    </div>
    <div class="hole hole6">
      <div class="mole"></div>
    </div>
  </div>
  <br />
  <div class="theleaderBoard">
    <h2>LeaderBoard</h2>
    <br />
    <button value="1" class="lbutton">Easy</button>
    <button value="2" class="lbutton">Normal</button>
    <button value="3" class="lbutton">Hard</button>
    <button value="4" class="lbutton">Insane</button>
    <button value="5" class="lbutton">GOD</button>
    <div class="lederberds">
      <div class="leaderboardEasy active lederberd">
        <h3>This is the top 10 for the easy difficulty!</h3>
        <ol>
        </ol>
      </div>
      <div class="leaderboardNormal lederberd">
        <h3>This is the top 10 for the normal difficulty!</h3>
        <ol>
        </ol>
      </div>
      <div class="leaderboardHard lederberd">
        <h3>This is the top 10 for the hard difficulty!</h3>
        <ol>
        </ol>
      </div>
      <div class="leaderboardInsane lederberd">
        <h3>This is the top 10 for the insane difficulty!</h3>
        <ol>
        </ol>
      </div>
      <div class="leaderboardGOD lederberd">
        <h3>This is the top 10 for the GOD mode difficulty!</h3>
        <ol>
        </ol>
      </div>
    </div>
  </div>

  <script>
    const holes = document.querySelectorAll('.hole');
    const scoreBoard = document.querySelector('.score');
    const moles = document.querySelectorAll('.mole');
    const scoreboard = JSON.parse(localStorage.getItem("items")) || [];
    const dbuttons = document.querySelectorAll(".button");
    const lbuttons = document.querySelectorAll(".lbutton");
    const leaderboard = document.querySelector(".theleaderBoard");
    const lederberds = leaderboard.querySelectorAll(".lederberd");
    const timer = document.querySelector(".timer");
    let lastHole;
    let timeUp = false;
    let score = 0;
    let countdown;

    function randomTime(min, max) {
      return Math.floor(Math.random() * (max - min) + min);
    }

    function randomHole(holes) {
      const holeIndex = Math.floor(Math.random() * holes.length);
      const hole = holes[holeIndex];
      if (hole === lastHole) {
        return randomHole(holes);
      }
      lastHole = hole;
      return hole;
    }

    function pop(popMin, popMax) {
      const time = randomTime(popMin, popMax);
      const hole = randomHole(holes);
      hole.classList.add("up");
      setTimeout(() => {
        hole.classList.remove("up");
        if (!timeUp) pop(popMin, popMax);
      }, time);
    }

    function startGame(timeToPlay, popMin, popMax) {
      dbuttons.forEach(button => button.setAttribute("disabled", ""));
      timeUp = false;
      scoreBoard.textContent = 0;
      score = 0;
      theTimer(6, timeToPlay);
      setTimeout(() => pop(popMin, popMax), 6000);
      setTimeout(() => {
        timeUp = true;
        setTimeout(() => gameOver(), popMax);
      }, (timeToPlay + 6) * 1000);
    }

    function hitMole(e) {
      if (!e.isTrusted) return;
      score++;
      this.parentNode.classList.remove("up");
      scoreBoard.textContent = score;
    }

    function theTimer(seconds, timeToPlay) {
      clearInterval(countdown);
      displayTimer(seconds);
      let timeLeft = timeToPlay;

      countdown = setInterval(() => {
        if (timeLeft < -timeToPlay) {
          clearInterval(countdown);
          return;
        }
        console.log(timeLeft);
        displayTimer(timeLeft, timeToPlay);
        timeLeft--;
      }, 1000);
    }

    function displayTimer(seconds, timeToPlay) {
      //display the time before the game starts
      timer.textContent = seconds > seconds - timeToPlay ? seconds - timeToPlay : "GOGOGO!";
      if(seconds < timeToPlay) {
        setTimeout(() => {
          timer.textContent = timeToPlay;
        }, 1000);
      }
      //after the game has started display the countdown time
      //before the game ends
    }

    function gameOver() {
      score = scoreBoard.textContent;
      clearInterval(countdown);
      timer.textContent = "Game is now over and your score is :" + score;
      dbuttons.forEach(button => button.removeAttribute("disabled"));
    }

    function updateLeaderboard() {
      let clickedButtonValue = `${"leaderboard"}${this.textContent}`;
      let leaderi = this.value;
      let leader = lederberds[leaderi - 1];
      console.log(leaderi, leader);
      leader.classList.add("active");
      //remove the ones that arent the leaderi indexed
      for (let i = 0; i < lederberds.length; i++) {

      }
    }

    moles.forEach(mole => mole.addEventListener("click", hitMole));
    lbuttons.forEach(button => button.addEventListener("click", updateLeaderboard));


  </script>
</body>

</html>